name: Send Emails

on:
  workflow_dispatch: {}
  repository_dispatch: {}

concurrency:
  group: lead-pipeline
  cancel-in-progress: false

permissions:
  contents: write

jobs:
  send-emails:
    runs-on: ubuntu-latest

    env:
      EMAIL_ADDRESS: ${{ secrets.EMAIL_ADDRESS }}
      EMAIL_PASSWORD: ${{ secrets.EMAIL_PASSWORD }}
      FROM_EMAIL: ${{ secrets.FROM_EMAIL }}
      IMAP_PORT: ${{ secrets.IMAP_PORT }}
      IMAP_SERVER: ${{ secrets.IMAP_SERVER }}
      ZOHO_ACCOUNT_ID: ${{ secrets.ZOHO_ACCOUNT_ID }}
      ZOHO_CLIENT_ID: ${{ secrets.ZOHO_CLIENT_ID }}
      ZOHO_CLIENT_SECRET: ${{ secrets.ZOHO_CLIENT_SECRET }}
      ZOHO_REFRESH_TOKEN: ${{ secrets.ZOHO_REFRESH_TOKEN }}

    steps:
      - name: Set up Python
    uses: actions/setup-python@v5
    with:
      python-version: '3.11'

  - name: Install Dependencies
    run: pip install requests

  - name: Run Script
    run: python pipeline.py

  - name: Commit updated leads
    run: |
      git config --global user.name github-actions
      git config --global user.email github-actions@users.noreply.github.com
      git add leads/
      git commit -m "update: pipeline auto commit" || echo "No changes to commit"
      git push

