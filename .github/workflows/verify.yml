name: Verify Emails with Tor

on:
  workflow_dispatch:

jobs:
  verify:
    runs-on: ubuntu-latest

    env:
      TOR_CONTROL_PASSWORD: ${{ secrets.TOR_CONTROL_PASSWORD }}

    steps:
      - name: ‚¨áÔ∏è Checkout Repo
        uses: actions/checkout@v3

      - name: üêç Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      - name: üõ† Install dependencies
        run: |
          sudo apt update
          sudo apt install -y tor torsocks
          pip install stem dnspython PySocks

      - name: ‚öôÔ∏è Configure Tor
        run: |
          echo "ControlPort 9051" | sudo tee -a /etc/tor/torrc
          echo "CookieAuthentication 0" | sudo tee -a /etc/tor/torrc
          echo "HashedControlPassword ${TOR_CONTROL_PASSWORD}" | sudo tee -a /etc/tor/torrc
          sudo systemctl restart tor
          sleep 5

      - name: üìÅ Check permutations.txt exists
        run: |
          if [ ! -f permutations.txt ]; then
            echo "‚ùå permutations.txt not found"; exit 1;
          fi

      - name: üîç Run verifier.py
        run: python verifier.py
